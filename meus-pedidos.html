<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MUTT | MEUS PEDIDOS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #000; color: #fff; }
        .glass-card { background: #0a0a0a; border: 1px solid #1a1a1a; transition: 0.3s; }
        .status-badge { font-size: 8px; padding: 4px 8px; border-radius: 2px; text-transform: uppercase; font-weight: 900; }
        .status-pendente { background: #facc15; color: #000; }
        .status-enviado { background: #3b82f6; color: #fff; }
        .status-entregue { background: #10b981; color: #fff; }
    </style>
</head>
<body class="bg-black min-h-screen">

    <header class="p-6 border-b border-zinc-900 flex justify-between items-center">
        <a href="index.html"><img src="https://i.postimg.cc/L5zZY3TJ/transparent-Photoroom-(2).png" class="w-16 invert"></a>
        <h1 class="text-[10px] font-black uppercase tracking-[0.4em]">Meus Pedidos</h1>
        <a href="index.html" class="text-zinc-500 text-xl"><i class="fa-solid fa-xmark"></i></a>
    </header>

    <main class="container mx-auto px-6 py-12 max-w-2xl">
        <div id="pedidos-container" class="space-y-6">
            <div class="text-center py-20 opacity-20">
                <i class="fa-solid fa-circle-notch animate-spin text-3xl mb-4"></i>
                <p class="text-[10px] font-black uppercase tracking-widest">Sincronizando com a Nuvem...</p>
            </div>
        </div>
    </main>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDr-W03cp72jHiyALGWlI4vBfxH2xrC-6w",
            authDomain: "mutt-streetwear.firebaseapp.com",
            databaseURL: "https://mutt-streetwear-default-rtdb.firebaseio.com",
            projectId: "mutt-streetwear",
            storageBucket: "mutt-streetwear.firebasestorage.app",
            messagingSenderId: "65929911570",
            appId: "1:65929911570:web:86299846ef5401b5c0a7cb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        onAuthStateChanged(auth, (user) => {
            if (user) {
                carregarPedidos(user.uid);
            } else {
                window.location.href = 'login.html';
            }
        });

        function carregarPedidos(uid) {
            // Buscamos apenas os pedidos que tem o UID do usuário
            const pedidosRef = ref(db, `pedidos`);
            onValue(pedidosRef, (snapshot) => {
                const data = snapshot.val();
                const container = document.getElementById('pedidos-container');
                container.innerHTML = "";

                let meusPedidos = [];
                if (data) {
                    // Filtra os pedidos que pertencem a este usuário
                    meusPedidos = Object.keys(data)
                        .map(id => ({ id, ...data[id] }))
                        .filter(p => p.clienteId === uid);
                }

                if (meusPedidos.length === 0) {
                    container.innerHTML = `
                        <div class="text-center py-20 border border-dashed border-zinc-900">
                            <p class="text-[10px] text-zinc-500 font-black uppercase tracking-widest">Nenhum pedido encontrado.</p>
                            <a href="index.html" class="inline-block mt-6 bg-white text-black px-6 py-3 text-[10px] font-black uppercase">Ir para a Loja</a>
                        </div>
                    `;
                    return;
                }

                // Renderiza os pedidos (do mais novo para o mais antigo)
                meusPedidos.reverse().forEach(p => {
                    const statusClass = `status-${p.status.toLowerCase()}`;
                    
                    container.innerHTML += `
                        <div class="glass-card p-6 rounded-sm">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <p class="text-[9px] text-zinc-600 font-black uppercase tracking-tighter">Pedido #${p.id.substring(p.id.length - 6)}</p>
                                    <h3 class="text-xs font-black uppercase mt-1 italic">${p.data}</h3>
                                </div>
                                <span class="status-badge ${statusClass}">${p.status}</span>
                            </div>

                            <div class="space-y-4 mb-6 border-y border-zinc-900 py-4">
                                ${p.itens.map(item => `
                                    <div class="flex items-center gap-4">
                                        <img src="${item.img}" class="w-12 h-14 object-cover">
                                        <div>
                                            <p class="text-[10px] font-black uppercase">${item.nome}</p>
                                            <p class="text-[9px] text-zinc-500">TAM: ${item.tamanho} | QTD: 1</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>

                            <div class="flex justify-between items-center">
                                <div>
                                    <p class="text-[8px] text-zinc-500 uppercase font-black">Total Pago</p>
                                    <p class="text-sm font-black tracking-tighter">R$ ${p.total.toFixed(2)}</p>
                                </div>
                                <a href="https://wa.me/551194984188337?text=Olá, queria informações sobre meu pedido #${p.id.substring(p.id.length - 6)}" 
                                   target="_blank" 
                                   class="text-[9px] font-black uppercase border border-zinc-800 px-4 py-2 hover:bg-white hover:text-black transition">
                                   Suporte <i class="fa-brands fa-whatsapp ml-1"></i>
                                </a>
                            </div>
                        </div>
                    `;
                });
            });
        }
    </script>
</body>
</html>
